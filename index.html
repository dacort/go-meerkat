<!DOCTYPE HTML>
<html>

<head>
  <script src="http://code.jquery.com/jquery-2.1.3.min.js"></script>
  <script type="text/javascript">
  window.onload = function () {

    var dps = []; // dataPoints

    var chart = new CanvasJS.Chart("chartContainer",{
      title :{
        text: "Meerkats Live Now"
      },      
      data: [{
        type: "line",
        dataPoints: dps
      }],
      axisX:{
        intervalType: "second",        
        valueFormatString: "hh:mm:ss TT K", 
        labelAngle: -20
      },
    });

    var xVal = 0;
    var yVal = 0; 
    var updateInterval = 1000;
    var dataLength = 60*5; // number of dataPoints visible at any point

    var updateChart = function (count) {

      $.getJSON( "https://resources.meerkatapp.co/broadcasts", function( data ) {
        var numResults = data.result.length;
        dps.push({
          x: new Date(),
          y: numResults
        });

        if (dps.length > dataLength)
        {
          dps.shift();        
        }
        
        chart.render();   
      }); 

    };

    // generates first set of dataPoints
    updateChart(dataLength); 

    // update chart after specified time. 
    setInterval(function(){updateChart()}, updateInterval); 

  }
  </script>
  <script type="text/javascript" src="assets/canvasjs.min.js"></script>
</head>
<body>
  <div id="chartContainer" style="height: 300px; width:100%;">
  </div>
</body>
</html>
